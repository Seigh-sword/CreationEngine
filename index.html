<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CreationEngine | All-In-One</title>
    <style>
        :root { --neon: #00ff88; --bg: #0a0a0c; --panel: #16161a; }
        body { background: var(--bg); color: #e0e0e0; font-family: 'Courier New', monospace; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { padding: 10px 20px; display: flex; justify-content: space-between; border-bottom: 1px solid #333; }
        #connection-dot { width: 10px; height: 10px; background: var(--neon); border-radius: 50%; display: inline-block; box-shadow: 0 0 10px var(--neon); }
        main { display: flex; flex: 1; overflow: hidden; }
        section { flex: 1; display: flex; flex-direction: column; padding: 15px; border: 1px solid #222; }
        textarea { flex: 1; background: var(--panel); color: var(--neon); border: 1px solid #333; padding: 15px; font-size: 14px; resize: none; outline: none; }
        #runtime-display { flex: 1; background: #000; overflow-y: auto; padding: 20px; border: 1px solid #333; }
        .tools { padding: 10px 0; display: flex; gap: 10px; }
        button { background: var(--neon); color: black; border: none; padding: 10px 20px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { filter: brightness(1.2); }
        img { max-width: 100%; border: 1px solid #444; margin-top: 10px; }
    </style>
</head>
<body>

<header>
    <div><strong>CreationEngine v1.0</strong></div>
    <div><span id="connection-dot"></span> <span id="user-status">Cloud Active</span></div>
</header>

<main>
    <section>
        <div style="margin-bottom:5px">SOURCE (.crts)</div>
        <textarea id="crts-input" placeholder="{div} Hello World {/div}">{div} 
  <h1>Welcome to the Engine</h1>
  {img}(A futuristic terminal screen showing neon code)
  {sfx}(digital computer beep)
{/div}</textarea>
        <div class="tools">
            <button id="run-btn">RUN ENGINE</button>
            <button id="save-btn" style="background:#555; color:white;">SAVE TO CLOUD</button>
        </div>
    </section>

    <section>
        <div style="margin-bottom:5px">LIVE PREVIEW</div>
        <div id="runtime-display"></div>
    </section>
</main>

<script type="module">
    // --- DATABASE & AI CORE ---
    const CLOUD_URL = "https://script.google.com/macros/s/AKfycbyvcPsgDniiS6ubijvaWqiumvTOksFI5KnMIW9sI2E4MPDvUODwWlBZT4junhktuHAeog/exec";
    
    const AI = {
        async img(prompt) {
            const seed = Math.floor(Math.random() * 1000000);
            return `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?seed=${seed}&nologo=true`;
        },
        async sfx(prompt) {
            // Using the Web Audio API for an immediate "No-Key" procedural backup
            console.log("Synthesizing SFX for:", prompt);
            const ctx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain); gain.connect(ctx.destination);
            osc.type = 'square';
            osc.frequency.setValueAtTime(Math.random() * 400 + 100, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
            osc.start(); osc.stop(ctx.currentTime + 0.5);
        }
    };

    // --- COMPILER LOGIC ---
    async function runCompiler() {
        const input = document.getElementById('crts-input').value;
        const display = document.getElementById('runtime-display');
        display.innerHTML = "Generating...";

        let html = input.replace(/{div}/g, "<div>").replace(/{\/div}/g, "</div>");

        // Match and Replace {img}(prompt)
        const imgRegex = /{img}\((.*?)\)/g;
        let match;
        while ((match = imgRegex.exec(input)) !== null) {
            const url = await AI.img(match[1]);
            html = html.replace(match[0], `<img src="${url}">`);
        }

        // Match and Trigger {sfx}(prompt)
        const sfxRegex = /{sfx}\((.*?)\)/g;
        while ((match = sfxRegex.exec(input)) !== null) {
            AI.sfx(match[1]);
            html = html.replace(match[0], ""); 
        }

        display.innerHTML = html;
    }

    // --- CLOUD SAVE LOGIC ---
    async function saveToCloud() {
        const code = document.getElementById('crts-input').value;
        document.getElementById('connection-dot').style.background = "orange";
        
        await fetch(CLOUD_URL, {
            method: "POST",
            body: JSON.stringify({ method: "PUT", username: "default_user", data: { project: code } })
        });

        document.getElementById('connection-dot').style.background = "#00ff88";
        alert("Saved to Google Sheets!");
    }

    // --- EVENT LISTENERS ---
    document.getElementById('run-btn').onclick = runCompiler;
    document.getElementById('save-btn').onclick = saveToCloud;
</script>

</body>
</html>